<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FiableAuto ‚Äì Web App</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body data-theme="light">
  <header>
    <h1>üöó FiableAuto</h1>
    <div id="connectionStatus" class="connection-status">
      <i class="fas fa-wifi"></i> V√©rification...
    </div>
  </header>

  <!-- Navigation -->
  <nav class="nav">
    <button class="nav-pill active" data-section="gestionnaire"><i class="fas fa-user-tie"></i> Gestionnaire</button>
    <button class="nav-pill" data-section="prestataire"><i class="fas fa-user-cog"></i> Prestataire</button>
    <button class="nav-pill" data-section="client"><i class="fas fa-user"></i> Client</button>
  </nav>

  <!-- GESTIONNAIRE -->
  <section id="gestionnaire" class="section active">
    <h2>Cr√©er une mission</h2>
    <form id="missionForm" class="enhanced-form">
      <div class="form-grid">
        <input type="text" name="vehicleBrand" placeholder="Marque" required />
        <input type="text" name="vehicleModel" placeholder="Mod√®le" required />
        <input type="number" name="vehicleYear" placeholder="Ann√©e" />
        <input type="text" name="licensePlate" placeholder="Immatriculation" />
        <input type="number" name="mileage" placeholder="Kilom√©trage" />
        <input type="text" name="pickupLocation" placeholder="Lieu prise en charge" required />
        <input type="text" name="deliveryLocation" placeholder="Lieu livraison" required />
        <input type="date" name="pickupDate" />
        <input type="date" name="deliveryDate" />
        <input type="text" name="clientName" placeholder="Nom client" required />
        <input type="email" name="clientEmail" placeholder="Email client" required />
        <input type="text" name="clientPhone" placeholder="T√©l√©phone client" />
      </div>
      <button type="submit" class="btn-enhanced btn-primary">Cr√©er mission</button>
    </form>

    <h3>Missions archiv√©es</h3>
    <div id="missionsList"></div>
  </section>

  <!-- PRESTATAIRE -->
  <section id="prestataire" class="section">
    <h2>Acc√©der √† une mission</h2>
    <form id="accessForm" class="enhanced-form">
      <input type="text" id="missionCode" placeholder="Code mission" required />
      <button type="submit" class="btn-enhanced btn-primary">Acc√©der</button>
    </form>

    <div id="missionDetails" style="display:none; margin-top:20px;">
      <div id="missionInfo"></div>

      <!-- S√©lecteur EDL + validation d√©part -->
      <div id="edlPhaseSwitch" class="enhanced-form-section">
        <div class="section-title">
          <i class="fas fa-random"></i>
          <span>Phase EDL <small id="phaseBadge" style="margin-left:6px;">(D√©part)</small></span>
        </div>
        <div class="radio-group">
          <label class="radio-option">
            <input type="radio" name="edlPhase" value="depart" checked /> D√©part
          </label>
          <label class="radio-option">
            <input type="radio" name="edlPhase" value="arrivee" /> Arriv√©e
          </label>
        </div>
        <div style="margin-top:10px;">
          <button type="button" id="validateDepartBtn" class="btn-enhanced btn-success">
            <i class="fas fa-check"></i> Valider EDL D√©part
          </button>
          <span id="departValidLabel" style="margin-left:10px; color:#dc3545;">Non valid√©</span>
        </div>
      </div>

      <!-- Checklist -->
      <div id="checklist" class="enhanced-form-section">
        <div class="section-title"><i class="fas fa-list-check"></i> Checklist</div>
        <label><input type="radio" name="vehiclePapers" value="ok" /> Papiers ok</label>
        <label><input type="radio" name="gps" value="ok" /> GPS</label>
        <label><input type="radio" name="sdCard" value="ok" /> Carte SD</label>
        <label><input type="radio" name="safetyKit" value="ok" /> Kit s√©curit√©</label>
        <label><input type="radio" name="spareWheel" value="ok" /> Roue de secours</label>
      </div>

      <!-- Photos obligatoires -->
      <div class="enhanced-form-section">
        <h4><i class="fas fa-camera"></i> Photos obligatoires <small id="phasePhotoBadge">(D√©part)</small></h4>
        <div class="photo-grid">
          <div class="photo-card"><input type="file" data-photo="compteur" /></div>
          <div class="photo-card"><input type="file" data-photo="face-avant" /></div>
          <div class="photo-card"><input type="file" data-photo="face-arriere" /></div>
          <div class="photo-card"><input type="file" data-photo="lateral-gauche-avant" /></div>
          <div class="photo-card"><input type="file" data-photo="lateral-gauche-arriere" /></div>
          <div class="photo-card"><input type="file" data-photo="lateral-droit-avant" /></div>
          <div class="photo-card"><input type="file" data-photo="lateral-droit-arriere" /></div>
          <div class="photo-card"><input type="file" data-photo="moteur" /></div>
          <div class="photo-card"><input type="file" data-photo="interieur" /></div>
          <div class="photo-card"><input type="file" data-photo="carnet" /></div>
        </div>
      </div>

      <!-- Observations -->
      <div class="enhanced-form-section">
        <textarea id="observations" placeholder="Observations..."></textarea>
      </div>

      <!-- Signature (cach√©e jusqu'√† Arriv√©e) -->
      <div id="signatureBlock" style="display:none; margin-top:20px;">
        <h4><i class="fas fa-signature"></i> Signature du client</h4>
        <canvas id="signatureCanvas" width="500" height="200" style="border:1px solid #ccc;"></canvas>
        <div style="margin-top:10px;">
          <button type="button" id="clearSignature" class="btn-enhanced btn-secondary">Effacer</button>
          <button type="button" id="finalizeInspection" class="btn-enhanced btn-primary">Signer et Terminer</button>
        </div>
      </div>

      <!-- √âcran de fin -->
      <div id="finishScreen" style="display:none; text-align:center; margin-top:20px;">
        <h4>‚úÖ Mission finalis√©e</h4>
        <p>Retour √† l‚Äôaccueil prestataire‚Ä¶</p>
        <button id="goPrestataireHome" class="btn-enhanced btn-primary">
          <i class="fas fa-home"></i> Accueil Prestataire
        </button>
      </div>
    </div>
  </section>

  <!-- CLIENT -->
  <section id="client" class="section">
    <h2>Suivi client</h2>
    <form id="trackingForm" class="enhanced-form">
      <input type="text" id="trackingCode" placeholder="Code mission" required />
      <button type="submit" class="btn-enhanced btn-primary">Suivre</button>
    </form>
    <div id="trackingResult" style="display:none;">
      <div id="trackingInfo"></div>
      <div id="downloadSection" style="display:none;">
        <button id="downloadReport" class="btn-enhanced btn-success">T√©l√©charger rapport</button>
        <button onclick="sendReportByEmail()" class="btn-enhanced btn-secondary">Envoyer par email</button>
      </div>
    </div>
  </section>

  <div id="notification" class="notification"></div>
  <div id="loadingOverlay" class="loading-overlay"><div class="loader"></div></div>

  <script src="script.js"></script>
</body>
</html>
